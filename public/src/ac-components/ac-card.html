<imports >
    <link rel="import" href='../../bower_components/polymer/polymer-element.html'>
    <link rel="import" href="../../bower_components/polymer/lib/elements/dom-if.html">
    <link rel="import" href="../../bower_components/paper-input/paper-input.html">
    <link rel="import" href="../../bower_components/iron-collapse/iron-collapse.html">
    <link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
    <link rel="import" href="../../bower_components/paper-ripple/paper-ripple.html">
    <link rel="import" href="../../bower_components/iron-icon/iron-icon.html" >
    <link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
</imports>
<icon-imports >
    <link rel="import" href="../../bower_components/iron-icons/hardware-icons.html">
    <link rel="import" href="../../bower_components/iron-icons/social-icons.html">
    <link rel="import" href="../../bower_components/iron-icons/image-icons.html">
    <link rel="import" href="../../bower_components/iron-icons/av-icons.html">
    <link rel="import" href="../../bower_components/iron-icons/communication-icons.html">
</icon-imports>

<dom-module id="ac-card">
    <template>
        <styles >
            <style middle>
                iron-icon {
                    margin-bottom: 3px;
                    color: var(--background-color0,#D7D3D1);
                }
                iron-icon[isViewAudio] {
                    /* margin-bottom: 3px; */
                    color: var(--theme-color12,#4775D1);
                }
                [middle] {
                    color: var(--title-color,#212121);
                    margin-top: 8px;
                    font-size: 17px;
                }
            </style>
            <style bottom>
                paper-icon-button {
                    background-color: var(--background-color1,#E5E1DF);
                    color: var(--paper-icon-color,#fafafa);
                    border-radius: 100%;
                    height: 41px;
                    width: 41px;
                }
                paper-icon-button:hover {
                    color:gray ; 
                }
                [bottom] {
                    user-select: text ; 
                    margin-top:0px ;
                    font-size: 20px;
                    font-weight: 500;
                    color: black;
                    margin-left: 5px;
                    width: 100%;
                    @apply --layout-center;
                    @apply --layout-horizontal;
                    @apply --layout-end-justified;
                }
                [acViewType] {
                    background-color: var(--background-color0,#efebe9) ; 
                    color:var(--background-color3,#efebe9) ; 
                    font-weight: 400 ; 
                    border-radius: 4px ;
                    padding-right:5px ;
                    padding-left:5px ; 
                    padding-top:2px ;
                    padding-bottom:2px ;
                }
                [cardTitle] {
                    margin-left:5px ;
                    font-weight: 400 ; 
                    opacity: 0.7 ; 
                    line-height: 1.5 ; 
                }
                [duration] {
                    font-weight: 400  ;
                    font-size: 17px ;
                    background-color: var(--background-color0,#efebe9) ; 
                    color:var(--background-color3,#efebe9) ; 
                    border-radius: 5px ; 
                    margin-right: 5px ;
                    padding-top:3px ; 
                    padding-bottom:3px ; 
                    padding-right:6px ;
                    padding-left:7px ;
                    @apply --layout-center;
                }
                [tags] {
                    margin-top: 5px ; 
                    font-weight: 300;
                    font-size: 16px;
                    width: 90%;
                    line-height: 2.5 ; 
                    user-select: text;
                }
                [tag]{
                    height: 20px ;
                    padding:5px ;
                    padding-right: 7px ;
                    padding-left: 7px ;
                    background-color: var(--theme-color1) ; 
                    margin:4px ; 
                    border-radius: 3px ; 
                    color: var(--content-background,#fafafa) ;
                    box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14),
                    0 1px 5px 0 rgba(0, 0, 0, 0.12),
                    0 3px 1px -2px rgba(0, 0, 0, 0.2);
                }
                [info] {
                    width: 20%;
                    @apply --layout-end-justified;
                    @apply --layout-horizontal;
                }
                [more] {
                    margin-right: 0;
                    margin-left: 0;
                    background-color: var(--background-color1,#E5E1DF);
                    height: 41px;
                    width: 41px;
                    margin-top: 10px;
                }
                [votes] {
                    color: var(--title-color,#212121);
                }
            </style>
            <style cardInfo>
                iron-collapse {
                    width: 100%;
                    margin-left: 5px;
                }
                #licenseLink:hover{
                    color: var(--theme-color1,#4775D1);
                    cursor: pointer ; 
                }
                [details] {
                    margin-top: 10px ;
                    width: 100%;
                    @apply --layout-horizontal;
                    @apply --layout-justified;
                }
                [property]{
                    margin-bottom: 5px ;
                }
                [cardInfo] {
                    font-size: 16px;
                    margin-left: 5px;
                    margin-right: 30px;
                    user-select: text;
                }
                [description] {
                    padding: 12px;
                    margin-right: 7px;
                    user-select: text ; 
                    @apply --justify-text;
                    @apply --layout-horizontal;
                    @apply --layout-justified;
                }
                [bold] {
                    font-weight: 500;
                }
                paper-button {
                    background-color: var(--theme-color1,#4775D1);
                    color: white;
                    margin-top: 20px;
                    margin-left: 20px;
                }
                [extra-buttons] {
                    margin-top: 5px ;
                    @apply --layout-center;
                    @apply --layout-vertical;
                    @apply --layout-justified;
                }
                [extra-icon] {
                    margin-top: 2px ;
                    background-color: var(--background-color1,#E5E1DF);
                    height: 41px;
                    width: 41px;
                }
            </style>
            <style>
                :host {
                    color:var(--title-color0,#1D1D1D) ;
                }
                .hide{
                    visibility: hidden ; 
                }
                [listItem] {
                    font-size: 18px;
                    margin-bottom: 20px;
                    padding: 20px 20px 13px;
                    border-radius: 4px;
                    opacity: 0.95;
                    background-color: var(--background-color,#efebe9);
                    position: relative;
                    @apply --layout-vertical;
                }
                [listItem]:hover {
                    opacity: 1;
                }
                [top] {
                    font-size: 19px;
                }
                [clickArea] {
                    @apply --no-user-select;
                    -webkit-tap-highlight-color:rgba(0,0,0,0);
                    margin-left: 5px;
                    cursor: pointer;
                }
                [clickArea][no-click]{
                    cursor: default ;
                }
            </style>
            <style dialog>
                paper-input {
                    --paper-input-container-label: {
                        color: var(--title-color,#212121);
                        font-size: 18px;
                        font-weight: 300;
                    };
                    --paper-input-container-input: {
                        color: var(--title-color,#212121);
                        font-size: 20px;
                        font-weight: 300;
                    };
                }
            </style>
        </styles>
        <div listItem>
            <div clickArea no-click$=[[noClick]] id="{{cardId}}" on-click="_selectCard">
                <template is="dom-if" if="[[!noClick]]" >
                    <paper-ripple></paper-ripple>
                </template>

                <template is="dom-if" if="[[isCourse]]">
                    <div top>
                        <span cardTitle> {{courseName}} </span>
                    </div>
                    <div middle style='margin-left:10px'>
                        <!-- <iron-icon icon="social:person-outline"></iron-icon> -->
                        &nbsp
                        <!-- <template is="dom-if" if="[[!isViewAudio]]"> -->
                            <!-- <iron-icon icon="image:remove-red-eye"></iron-icon> -->
                            <!-- {{acView}} -->
                            {{courseId}}
                        <!-- </template> -->
                    </div>
                    <div description>
                        {{observations}}
                    </div>
                </template>
                <template is="dom-if" if="[[!isCourse]]">
                    <div top>
                        <span cardTitle> {{givenName}} {{familyName}} </span>
                    </div>
                    <div middle style='margin-left:10px'>
                        <!-- <iron-icon icon="social:person-outline"></iron-icon> -->
                        {{gender}}
                        &nbsp
                        <!-- <template is="dom-if" if="[[!isViewAudio]]"> -->
                            <!-- <iron-icon icon="image:remove-red-eye"></iron-icon> -->
                            <!-- {{acView}} -->
                            {{personalId}}
                        <!-- </template> -->
                    </div>
                    <div description>
                        {{observations}}
                    </div>
                </template>
            </div>
            <div bottom>
                <!-- <div info> -->
                    <!-- <div buttons style="width:41px; height:41px; margin-bottom: 10px ; "> -->
                        <paper-icon-button style='margin-right:10px;' id=[[icon1Id]] on-click='_action' icon="icons:create"></paper-icon-button>
                        <paper-icon-button  index="{{id}}" on-click='_action' id='[[icon2]]' icon='[[icon2]]'></paper-icon-button>
                    <!-- </div> -->
                <!-- </div> -->
            </div>
        </div>
    </template>
    <script>
        class ACCard extends Polymer.Element {
            static get is() { return 'ac-card'; }
            static get properties() {return {
                isDemo:{type:Boolean,value:false},
                hasDate:{type:Boolean,value:true},
                isViewAudio:{type:Boolean,value:false},
                isCourse:{type:Boolean,value:false},
                hasMetronome:{type:Boolean},
                url:{type:String},
                acViewType:{type:String},
                acView:{type:String},
                givenName:{type:String},
                courseName:{type:String},
                courseId:{type:String},
                familyName:{type:String},
                personalId:{type:String},
                gender:{type:String},
                observations:{type:String},
                cardId:{observer:'hideCollapse'},
                open:{type:Boolean,value:false},
                icon1Id: {type: String,value: 'icons:create'},
                noClick:{type:Boolean,value:false},
                icon1: {type: String},
                icon2: {type: String},
                id: {type: String,value: ""}
            }}
            constructor() {
                super();
            }
            _setIcon (id, icon) {
                this.shadowRoot.querySelector('#' + id).icon = icon;
                this.icon1Id = icon;
            }
            _action (e) {
                if (e.currentTarget.id === 'expand-more') {
                    this.showDetails() ;
                }
                if (e.currentTarget.id === 'delete' || e.currentTarget.id === 'icons:delete') {
                    let index = parseInt(e.currentTarget.index.split ('_')[1]) ; 
                    this.dispatchEvent(new CustomEvent('delete-card', {detail:{
                        index:index,
                        id: this.cardId,
                        name: this.givenName
                    }, bubbles: true, composed: true }));
                }
                if (e.currentTarget.id === 'editor:mode-edit' || e.currentTarget.id === 'icons:create' || e.currentTarget.id === 'create') {
                    this.dispatchEvent(new CustomEvent('edit-card', {detail:{
                        id: this.cardId,
                        givenName: this.givenName,
                        familyName:this.familyName,
                        gender:this.gender,
                        observations:this.observations,
                        personalId:this.personalId,
                        courseName:this.courseName,
                        courseId:this.courseId
                    }, bubbles: true, composed: true }));
                }
                if (e.currentTarget.id === 'av:playlist-add' || e.currentTarget.id === 'collection-add') {
                    this.dispatchEvent(new CustomEvent('addToCollection', {detail:{
                        name: this.givenName,
                        id: this.cardId
                    }, bubbles: true, composed: true }));
                }
            }
            _selectCard (e) {
                if(this.noClick)
                    return ; 
                if(this.isViewAudio){
                    if(this.isDemo){
                        this.dispatchEvent(new CustomEvent('update-view-audio', {detail:{
                            viewAudioId:e.currentTarget.id,
                            isDemo:true
                        }, bubbles: true, composed: true }));
                    }
                    else {
                        this.dispatchEvent(new CustomEvent('update-view-audio', {detail:{
                            viewAudioId:e.currentTarget.id
                        }, bubbles: true, composed: true }));
                    }
                }
                else {
                    if(this.isDemo){
                        this.dispatchEvent(new CustomEvent('play-recording', {detail:{
                            id:e.currentTarget.id,
                            isDemo:true
                        }, bubbles: true, composed: true }));
                    }
                    else {
                        this.dispatchEvent(new CustomEvent('play-recording', {detail:{
                            id: e.currentTarget.id
                        }, bubbles: true, composed: true }));

                    }
                }
            }
            ready() {
                super.ready() ;
                if(this.type === 'viewAudios')
                    this.isViewAudio = true ; 
                this.addEventListener('select-collection', e => this._addToCollection(e));
            }
        }
        customElements.define('ac-card', ACCard);
    </script>
</dom-module>
